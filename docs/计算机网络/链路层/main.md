# 链路层

链路层结构
- 逻辑链路控制层LLC
- 介质访问控制层MAC 

## 逻辑链路层LLC

- 成帧
- 差错控制
- 流量控制

### 成帧

#### 字节计数

通过帧头指出字节数，很少用，出错了很难查出具体的出错位置

#### 标志字节填充

通过ESC字符字节加标志分割的字节来界定，原始文件中的ESC前同样需要加ESC字节。PPP协议使用标志字节填充

#### 标志比特填充

开始和结束使用一个特殊的比特`01111110`也就是十六进制`7E`来分割，内部bit流如果出现5个1就在后面加一个0

#### 物理层编码违禁法

在物理层编码时（数据->数字信号符号），可能数字信号的符号数还有剩下的，比如4B/5B编码用5个bit一组的数字信号符号编码一个4bit的数据，还剩下16个数字信号符号没用，可以用来界定帧开始和结束，以太网使用。


### 差错控制

#### 奇偶校验

校验位长度1，加上校验位中1的个数为奇数为奇校验码，加上校验位中1的个数为偶数为偶校验码

校验码计算
|||
|----|---|
|奇校验| 所有位数的异或的取反 |
|偶校验| 所有位数的异或|

只能检出1位的错误，多位的不行，接收方通过计算校验码一样的算法计算出0或者1，0表示无错，1表示有错

#### CRC校验

使用给定的G生成多项式，用数据除这个生成多项式，使用模2除法，得到的余数是校验码

数据长度为k,校验码长度为r,生成多项式的长度为r+1。实际计算中使用移位和异或

- 数据左移r位
- 生成多项式对齐数据的最高位（最高为1的位置）
- 异或（此时数据的最高位会变成0）
- 重复23步直到数据的有效长度小于等于r

检错能力：所有奇数个错，所有突发错误（从开始到结束的bit位长度小于等于r）

#### 海明码

是一种分组多重偶校验，原数据位为k位，校验码长度r位，满足不等式 $k+r+1 \leqslant 2^r$ ，这个式子表示校验码能表示的状态数应该大于等于校验后数据改变1位的状态（n=k+r）加上数据原状态（1）

- 计算校验码长度
- 在原数据中找到每个校验码位所处位置P ,所处位置是2的幂次，从左往右依次是1到`k+r`，这个P也是偶校验码中所有位置的二进制表示中低P位为1的为一组
- 每组进行偶校验获得校验码填入校验位

例：数据`1101`

- 根据 $k+r+1 \leqslant 2^r $有 $4+r+1\leqslant 2^r$，$r=3$，总共7位

    位置1(校验码1) 位置2(校验码2) 位置3(1) 位置4(校验码3) 位置5(1) 位置6(0) 位置7(1)

- 分别占位 位置1 位置2 位置4， 
- 分组1：位置1(1)，位置3(11)，位置5(101)，位置7(111)， 校验码1 = 1^1^1 = 1, 分组2：位置2(10)，位置3(11)，位置6(110)，位置7(111)，校验码2=1^0^1 = 0,分组3，位置4(100)，位置5(101)，位置6(110)，位置7(111)，校验码3= 1 ^ 0 ^ 1 = 0

最后的海明码为`1010101`

接收放校验的时候也是一样的逻辑，然后对每组进行偶校验

标准海明码纠错1位检错2位